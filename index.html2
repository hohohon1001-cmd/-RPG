<script>
/* =====================
   ê¸°ë³¸ ìŠ¤íƒ¯
===================== */
let coins = 0;
let atk = 1;

// ê°•í™”
let upgradeLv = 1;
let upgradeChance = 90;

// í”Œë ˆì´ì–´ ë ˆë²¨
let playerLv = 1;
let exp = 0;
let nextExp = 10;

// ëª¬ìŠ¤í„°
let monsterHp = 10;
let monsterMaxHp = 10;
let kills = 0;

// ë°©ì¹˜
let idle = false;
let idleTimer = null;

/* =====================
   ì§€ì—­ / ëª¬ìŠ¤í„°
===================== */
const areas = ["ğŸŒ± ì´ˆì›", "ğŸŒ´ ë°€ë¦¼", "â„ ëˆˆ", "ğŸŒ‹ í™”ì‚°", "ğŸŒŒ ê³µí—ˆ"];

const areaRequirements = {
  "ğŸŒ± ì´ˆì›": 1,
  "ğŸŒ´ ë°€ë¦¼": 10,
  "â„ ëˆˆ": 20,
  "ğŸŒ‹ í™”ì‚°": 30,
  "ğŸŒŒ ê³µí—ˆ": 40
};

const monsters = {
  "ğŸŒ± ì´ˆì›": ["ìŠ¬ë¼ì„", "ì•¼ìƒ í† ë¼", "ì´ˆì› ë²Œë ˆ"],
  "ğŸŒ´ ë°€ë¦¼": ["ê³ ë¸”ë¦°", "ë… ê°œêµ¬ë¦¬", "ë°€ë¦¼ ëŠ‘ëŒ€"],
  "â„ ëˆˆ": ["ë¹™ê²°ìˆ˜", "ì„¤ì› ëŠ‘ëŒ€", "ëˆˆ ê³¨ë ˜"],
  "ğŸŒ‹ í™”ì‚°": ["í™”ì—¼ë ¹", "ë§ˆê·¸ë§ˆ ë¹„ìŠ¤íŠ¸", "ìš©ì•” ê³¨ë ˜"],
  "ğŸŒŒ ê³µí—ˆ": ["ì´ë¦„ ì—†ëŠ” ì¡´ì¬", "ê³µí—ˆì˜ ëˆˆ", "ì™œê³¡ëœ ê¸°ì‚¬"]
};

/* =====================
   ìœ í‹¸
===================== */
function upgradeCost() {
  return 10 + upgradeLv * 5;
}

function getAvailableAreaIndex() {
  let idx = 0;
  for (let i = 0; i < areas.length; i++) {
    if (playerLv >= areaRequirements[areas[i]]) idx = i;
    else break;
  }
  return idx;
}

function areaIndex() {
  const progress = Math.floor(kills / 6);
  const allowed = getAvailableAreaIndex();
  return Math.min(progress, allowed);
}

/* =====================
   ëª¬ìŠ¤í„° ìƒì„±
===================== */
function spawnMonster() {
  const idx = areaIndex();
  const area = areas[idx];
  const pool = monsters[area];

  monsterMaxHp = 10 + kills * 3 + idx * 20;
  monsterHp = monsterMaxHp;

  document.getElementById("monsterName").textContent =
    pool[Math.floor(Math.random() * pool.length)];

  document.getElementById("areaText").textContent = area;
  document.getElementById("log").textContent = `${area}ì— ë„ì°©í–ˆë‹¤â€¦`;

  const nextIdx = idx + 1;
  if (nextIdx < areas.length) {
    const needLv = areaRequirements[areas[nextIdx]];
    if (playerLv < needLv) {
      document.getElementById("log").textContent =
        `ğŸ”’ ${areas[nextIdx]} ì§„ì… ì¡°ê±´: LV ${needLv}`;
    }
  }

  updateMonsterUI();
}

/* =====================
   ê³µê²©
===================== */
function attack(dmg) {
  monsterHp -= dmg;
  document.getElementById("hitSound").play();

  if (monsterHp <= 0) {
    kills++;

    const idx = areaIndex();
    coins += 5 + idx * 5;
    exp += 3 + idx * 2;

    levelUpCheck();
    spawnMonster();
  }

  updateUI();
}

function manualAttack() {
  attack(atk);
}

/* =====================
   ë ˆë²¨ì—…
===================== */
function levelUpCheck() {
  while (exp >= nextExp) {
    exp -= nextExp;
    playerLv++;
    nextExp = Math.floor(nextExp * 1.4);
    atk += 1;

    document.getElementById("log").textContent =
      `ğŸ‰ ë ˆë²¨ì—…! LV ${playerLv}`;
  }
}

/* =====================
   ê°•í™”
===================== */
function upgrade() {
  const cost = upgradeCost();

  if (coins < cost) {
    document.getElementById("log").textContent =
      `ğŸ’° ì½”ì¸ì´ ë¶€ì¡±í•˜ë‹¤ (${cost})`;
    return;
  }

  coins -= cost;

  const awakened = upgradeLv >= 10;
  const realChance = awakened
    ? Math.min(95, upgradeChance + 10)
    : upgradeChance;

  if (Math.random() * 100 <= realChance) {
    upgradeLv++;
    atk += awakened ? 2 : 1;
    upgradeChance = Math.max(10, upgradeChance - (awakened ? 1 : 2));

    document.getElementById("upgradeSound").play();
    document.getElementById("log").textContent =
      awakened ? `ğŸ”¥ ê°ì„± ì„±ê³µ! ê°•í™” ${upgradeLv}` : `ê°•í™” ì„±ê³µ!`;
  } else {
    document.getElementById("log").textContent =
      awakened ? `ğŸ’€ ê°ì„± ì‹¤íŒ¨â€¦` : `ê°•í™” ì‹¤íŒ¨â€¦`;
  }

  updateUI();
}

/* =====================
   ë°©ì¹˜
===================== */
function toggleIdle() {
  idle = !idle;
  document.getElementById("idleState").textContent = idle ? "ON" : "OFF";

  if (idle) {
    idleTimer = setInterval(() => attack(atk), 1000);
  } else {
    clearInterval(idleTimer);
  }
}

/* =====================
   UI
===================== */
function updateMonsterUI() {
  document.getElementById("hpFill").style.width =
    (monsterHp / monsterMaxHp) * 100 + "%";
}

function updateUI() {
  document.getElementById("coin").textContent = coins;
  document.getElementById("atk").textContent = atk;
  document.getElementById("upgradeLv").textContent = upgradeLv;
  document.getElementById("chanceText").textContent = upgradeChance;
  updateMonsterUI();

  const btn = document.getElementById("upgradeBtn");
  if (btn && upgradeLv >= 10) {
    btn.classList.add("awakened");
    btn.textContent = "ğŸ”¥ ê°ì„±";
  }
}

/* =====================
   ì‹œì‘
===================== */
spawnMonster();
updateUI();
</script>
